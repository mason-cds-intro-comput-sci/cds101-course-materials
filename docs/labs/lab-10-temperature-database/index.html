<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDS 101: Introduction to Computational and Data Sciences</title>
    <link rel="stylesheet" href="/theme/css/cds101.min.css">
    <link rel="stylesheet" href="/theme/css/custom.css">
      <link rel="stylesheet" href="/theme/css/vendor/katex/katex.min.css">
      <link rel="stylesheet" href="/theme/css/vendor/highlightjs/default.css">
      <link rel="stylesheet" href="/theme/css/vendor/fontawesome/fa-svg-with-js.css">
</head>  <body>
    <div class="header-grid-container">
<div class="banner-container">
  <header>
    <div class="banner">
      <div class="course-logo">
        <a href="/"><img src="/theme/img/course-logo.svg"></a>
      </div>
      <div class="university-logo">
        <a href="https://gmu.edu"><img src="/theme/img/university-logo.svg"></a>
      </div>
    </div>
  </header>
</div>    </div>
<div class="navbar-container">
  <nav class="navbar">
    <div class="navbar-mobile" data-responsive-toggle="main-menu" data-hide-for="large">
      <button type="button" data-toggle="main-menu"><i class="fas fa-bars"></i><span class="navbar-mobile-title">Menu</span></button>
    </div>

    <div class="navbar-menu" id="main-menu">
      <ul class="navbar-menu-list">
        <li>
          <a class="navbar-home-item" href="/"><i class="fas fa-home" data-fa-transform="grow-8"></i></a>
        </li>
            <li>
              <a class="navbar-menu-item" href="/https://labs.cds101.com">CDS 102 Labs</a>
            </li>
      </ul>
    </div>
  </nav>
</div>    <div class="content-grid-container">
    <article class="static-page">
<header class="static-page-header">
  <h1 class="static-page-title">Lab 10 – Build and Explore a Temperature&nbsp;Database</h1>
</header><div class="static-page-body">
  <h2>Instructions</h2>
<p>Obtain the GitHub repository you will use to complete the lab, which contains a starter file named [lab10.Rmd]{.monospace}.
This lab guides you through the process of building an automated pipeline to download and clean a series of files in order to build a database of average daily temperatures for you to explore.
Carefully read the lab instructions and complete the exercises using the provided spaces within your starter file [lab10.Rmd]{.monospace}.
Then, when you&#8217;re ready to submit, follow the directions in the <a href="#how-to-submit"><i class="fas fa-link"></i>How to submit</a> section&nbsp;below.</p>
<h2>Simplify your life with&nbsp;automation</h2>
<p>Many problems in data science are solved using a series of repetitive and predictable tasks.
Perhaps you&#8217;ve noticed this yourself as you&#8217;ve completed the labs in this course, for example when you&#8217;re asked to create data visualizations for several different columns in a dataset or you&#8217;re asked to apply the same general sequence of data transformations with slight modifications.
Maybe you&#8217;ve found an interesting dataset that is split into dozens of different files that you have to download individually and then try and combine.
From start to finish, there can be many times you think to yourself &#8220;this is just the same code from before with one change, why do I need to do this again?&#8221;
It is when these moments and patterns show up that it is worth considering the question, &#8220;can I automate&nbsp;this?&#8221;</p>
<p>Learning how to use R to automate even a small subset of your data science brings with it many benefits, such&nbsp;as:</p>
<ul>
<li>
<p>Writing less code to complete a data science&nbsp;problem</p>
</li>
<li>
<p>Reducing the number of errors that can be introduced through copying and pasting code that you then manually&nbsp;edit</p>
</li>
<li>
<p>Making it easier to fetch updates from a data source and integrate them into your existing&nbsp;database</p>
</li>
</ul>
<p>So why haven&#8217;t we been using these ideas since the beginning of the course?
It is because, in practice, automating your work requires the use of computer programming concepts that are more advanced.
This can get in the way of learning the basics of data science, such as visualization, data transformations, statistical analysis, and writing reports to summarize and present your work.
Also, early on in the course when you are asked to complete simpler exercises, applying automation may appear (and indeed be) unnecessary, and just add to the confusion of why we should bother with it.
Now that you have some experience with R and the [tidyverse]{.monospace}, it is worth stepping through a straightforward, real-world example that demonstrates how this can be used to your&nbsp;benefit.</p>
<p>For this lab, we will put together an automated pipeline to download, read, and combine the data files from the <em>University of Dayton - Environmental Protection Agency Average Daily Temperature Archive</em>, <a href="http://academic.udayton.edu/kissock/http/Weather/default.htm">http://academic.udayton.edu/kissock/http/Weather/default.htm</a>.
After we assemble our pipeline to acquire our data, we will then explore our new dataset using our familiar [tidyverse]{.monospace}&nbsp;tools.</p>
<p>Let&#8217;s&nbsp;begin!</p>
<h2>About the&nbsp;dataset</h2>
<p><a href="http://academic.udayton.edu/kissock/http/Weather/default.htm"><i class="fas fa-link"></i>The Average Daily Temperature Archive</a> reports the average daily temperature from January 1995 to the present day for 157 <span class="caps">U.S.</span> and 167 international cities and are updated on a regular basis.
Source data are from the Global Summary of the Day (<span class="caps">GSOD</span>) database archived by the <a href="https://www.ncdc.noaa.gov/"><i class="fas fa-link"></i>National Centers for Environmental Information</a> (formerly the National Climatic Data Center).
The average daily temperatures posted on this site are computed from 24 hourly temperature readings in the <a href="ftp://ftp.ncdc.noaa.gov/pub/data/gsod/"><i class="fas fa-link"></i>Global Summary of the Day (<span class="caps">GSOD</span>) data</a>.</p>
<p>As part of this lab, you will be walked through the procedure of downloading the data files and reading them into R.
The data files themselves are plain text and format the data into four columns.
The table below provides descriptions for the 4 variables stored within each&nbsp;file,</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="monospace">[1]</td>
<td>integer between 1 – 12 (January – December) corresponding to the month</td>
</tr>
<tr>
<td class="monospace">[2]</td>
<td>integer between 1 – 31 corresponding to the calendar day in a given month</td>
</tr>
<tr>
<td class="monospace">[3]</td>
<td>integer between 1995 – 2018 indicating the year</td>
</tr>
<tr>
<td class="monospace">[4]</td>
<td>the average daily temperature for the given day</td>
</tr>
</tbody>
</table>
<p>Temperature values (column 4) of [-99]{.monospace} indicate that the measurement for that day is&nbsp;unknown.</p>
<h2>Downloading the&nbsp;dataset</h2>
<p>Downloading a file from a website using R is straightforward, you just need to know the file <span class="caps">URL</span>.</p>
<p>@.<br>
    Go to the website hosting the dataset, <a href="http://academic.udayton.edu/kissock/http/Weather/default.htm">http://academic.udayton.edu/kissock/http/Weather/default.htm</a>, and look for a link on the page labeled &#8220;All sites (in single 10 <span class="caps">MB</span> file)&#8221;.
    Right-click on this link and choose the option <em>Copy link address</em> (depending on your web browser, this option may instead be called <em>Copy link</em>, <em>Copy link location</em>, or similar).
    Then, go back to your R Markdown report file in RStudio Server and assign the link to a variable named [allsites_zip_url]{.monospace}, like&nbsp;so:</p>
<div class="highlight"><pre><span></span><span class="n">```r</span>
<span class="n">allsites_zip_url &lt;- &quot;http://dataset.url/goes/here&quot;</span>
<span class="n">```</span>

<span class="n">Note</span> <span class="n">that</span> <span class="n">the</span> <span class="n">pasted</span> <span class="n">link</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span> <span class="n">placed</span> <span class="n">in</span> <span class="n">quotation</span> <span class="n">marks.</span>
</pre></div>


<p>Now that we have the <span class="caps">URL</span>, we need to specify where we want to download the file.
We will use the convenient [fs]{.monospace} package to deal with filenames and directories, which is already loaded for you in the setup block of your R Markdown lab report.
We will be downloading the file to the [data/]{.monospace} folder, which should already be part of your lab report&nbsp;repository.</p>
<p>@.<br>
    To specify the [data/]{.monospace} folder for later use, put the following code in your R Markdown lab report and run&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="n">```r</span>
<span class="n">data_dir &lt;- path(&quot;data&quot;)</span>
<span class="n">```</span>
</pre></div>


<p>Now that we have the download folder to use, we also need to give the name of the file we are downloading, and tell R that we will want that file to be located <em>inside</em> the [data/]{.monospace}&nbsp;folder:</p>
<p>@.
    To specify the name of the file we are downloading and to have it end up inside the [data/]{.monospace} folder, put the following code in your R Markdown report and run&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="n">```r</span>
<span class="n">allsites_zip_path &lt;- path(data_dir, &quot;allsites&quot;, ext = &quot;zip&quot;)</span>
<span class="n">```</span>

<span class="n">In</span> <span class="n">a</span> <span class="n">second</span> <span class="n">code</span> <span class="n">block</span><span class="p">,</span> <span class="n">run</span> <span class="n">[allsites\_zip\_path]</span><span class="p">{</span><span class="n">.monospace</span><span class="p">}</span> <span class="n">to</span> <span class="n">confirm</span> <span class="n">that</span> <span class="n">you</span> <span class="n">see</span> <span class="n">[data</span><span class="o">/</span><span class="n">allsites.zip]</span><span class="p">{</span><span class="n">.monospace</span><span class="p">}</span><span class="n">.</span>
</pre></div>


<p>Now it&#8217;s time to download the&nbsp;file.</p>
<p>@curl-download-exercise.
    To download the file, put the following code in your R Markdown report and run&nbsp;it:</p>
<div class="highlight"><pre><span></span><span class="err">```r</span>
<span class="err">if (!file_exists(allsites_zip_path)) {</span>
<span class="err">  allsites_zip_url %&gt;%</span>
<span class="err">    curl_download(destfile = allsites_zip_path)</span>
<span class="err">}</span>
<span class="err">```</span>
</pre></div>


<p>When the code block has finished running, verify that it worked by going into your files browser in the lower-right window of RStudio and clicking on the [data/]{.monospace} folder.
You should see a file named [allsites.zip]{.monospace} that is approximately 13.7 <span class="caps">MB</span> in&nbsp;size.</p>
<p>What is going on in the code block that you just ran?
The <code>curl_download()</code> function comes from the [curl]{.monospace} package that was also pre-loaded in your R Markdown setup block.
This function does what it says, it downloads things.
You are downloading the file located at [allsites_zip_url]{.monospace} and saving it to the location [allsites_zip_path]{.monospace} ([destfile]{.monospace} is short for &#8220;destination&nbsp;file&#8221;).</p>
<p>@what-if-means.
    What about the part <code>if (!file_exists(allsites_zip_path))</code>?
    First, try running the code block from Exercise @curl-download-exercise again.
    You should notice that the block seems to run a lot faster this&nbsp;time.</p>
<div class="highlight"><pre><span></span><span class="k">Next</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="n">Exercise</span><span class="w"> </span><span class="nv">@what</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">means</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">lab</span><span class="w"> </span><span class="n">report</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="p">,</span><span class="w"></span>

<span class="err">```</span><span class="n">r</span><span class="w"></span>
<span class="n">file_exists</span><span class="p">(</span><span class="n">allsites_zip_path</span><span class="p">)</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>

<span class="k">Then</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"></span>

<span class="err">```</span><span class="n">r</span><span class="w"></span>
<span class="err">!</span><span class="n">file_exists</span><span class="p">(</span><span class="n">allsites_zip_path</span><span class="p">)</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>

<span class="n">Based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">giving</span><span class="w"> </span><span class="n">you</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Exercise</span><span class="w"> </span><span class="nv">@curl</span><span class="o">-</span><span class="n">download</span><span class="o">-</span><span class="n">exercise</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">faster</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">explain</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="err">`</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">file_exists</span><span class="p">(</span><span class="n">allsites_zip_path</span><span class="p">))</span><span class="err">`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">doing</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">code</span><span class="p">.</span><span class="o">**</span><span class="w"></span>
</pre></div>


<h2>Unzipping the data&nbsp;files</h2>
<p>We have our [allsites.zip]{.monospace} file, which is a file in the zip format.
We need to &#8220;unzip&#8221; this file in order to access the many files that are contained within&nbsp;it.</p>
<p>@.<br>
    In a code block, run the following&nbsp;code:</p>
<div class="highlight"><pre><span></span><span class="o">```</span><span class="n">r</span>
<span class="n">allsites_zip_path</span> <span class="o">%&gt;%</span>
  <span class="n">unzip</span><span class="p">(</span><span class="n">exdir</span> <span class="o">=</span> <span class="n">data_dir</span><span class="p">)</span>
<span class="o">```</span>

<span class="k">Check</span> <span class="n">the</span> <span class="p">[</span><span class="k">data</span><span class="o">/</span><span class="p">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span> <span class="n">folder</span> <span class="n">again</span> <span class="k">in</span> <span class="n">your</span> <span class="n">Files</span> <span class="n">tab</span> <span class="k">in</span> <span class="n">the</span> <span class="k">lower</span><span class="o">-</span><span class="k">right</span> <span class="n">side</span> <span class="k">of</span> <span class="n">RStudio</span> <span class="n">Server</span><span class="p">.</span>
<span class="n">What</span> <span class="n">has</span> <span class="n">happened</span> <span class="k">after</span> <span class="n">you</span> <span class="n">ran</span> <span class="n">this</span> <span class="n">command</span><span class="o">?</span>
</pre></div>


<h2>Extracting information from a file&nbsp;name</h2>
<p>There are a lot of data files contained in this zip file, so let&#8217;s just focus on one for&nbsp;now.</p>
<p>@.<br>
    Specify the data file for Huntsville, Alabama by running the following code&nbsp;block:</p>
<div class="highlight"><pre><span></span><span class="n">```r</span>
<span class="n">data_file &lt;- path(data_dir, &quot;ALHUNTSV&quot;, ext = &quot;txt&quot;)</span>
<span class="n">```</span>
</pre></div>


<p>If you run [data_file]{.monospace} in your <em>Console</em> window, you&#8217;ll&nbsp;get</p>
<p>[## [1] &#8220;data/<span class="caps">ALHUNTSV</span>.txt&#8221;]{.monospace}</p>
<p>as output.
There are some convenience functions available for interacting with the [path]{.monospace} format.
The <code>path_file()</code> function returns <strong>just</strong> the filename part of a path.
For&nbsp;example:</p>
<div class="highlight"><pre><span></span><span class="n">example_file_path</span> <span class="o">&lt;-</span> <span class="nf">path</span><span class="p">(</span><span class="s">&quot;content&quot;</span><span class="p">,</span> <span class="s">&quot;datafile&quot;</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="s">&quot;txt&quot;</span><span class="p">)</span>
<span class="n">example_file_path</span> <span class="o">%&gt;%</span>
  <span class="nf">path_file</span><span class="p">()</span>
</pre></div>


<p>[## [1]&nbsp;&#8220;datafile.txt&#8221;]{.monospace}</p>
<p>If we wanted the directory part of the path, we use <code>path_dir()</code>:</p>
<div class="highlight"><pre><span></span><span class="n">example_file_path</span> <span class="o">%&gt;%</span>
  <span class="nf">path_dir</span><span class="p">()</span>
</pre></div>


<p>[## [1]&nbsp;&#8220;content&#8221;]{.monospace}</p>
<p>If we wanted to remove the [.txt]{.monospace} extension, we use <code>path_ext_remove()</code>:</p>
<div class="highlight"><pre><span></span><span class="n">example_file_path</span> <span class="o">%&gt;%</span>
  <span class="nf">path_ext_remove</span><span class="p">()</span>
</pre></div>


<p>[## [1]&nbsp;&#8220;content/datafile&#8221;]{.monospace}</p>
<p>@path-file-cleanup.
    Apply two of the [path_]{.monospace} functions to reduce the [data_file]{.monospace} file path from [data/<span class="caps">ALHUNTSV</span>.txt]{.monospace} to [<span class="caps">ALHUNTSV</span>]{.monospace}.
    Assign the result to&nbsp;[data_file_name]{.monospace}.</p>
<p>The file names tell us the locations where the temperature measurements come from.
If the location is in the United States, then the first two letters are the two-letter abbreviation for a state and the remaining six letters give the city.
So, for [<span class="caps">ALHUNTSV</span>.txt]{.monospace}, the first two letters are [<span class="caps">AL</span>]{.monospace} for Alabama, and the last six letters are [<span class="caps">HUNTSV</span>]{.monospace}, for Huntsville.
For international locations, the first two letters are a two-letter country code and the last six are still a city name, for example [<span class="caps">AUPERTH</span>.txt]{.monospace} contains temperature measurements from Perth, Australia.
Because we will ultimately want to use <strong>all</strong> of the files in the [data/]{.monospace} directory, we should have a method for extracting the city name and the state/country codes directly from the&nbsp;filenames.</p>
<p>The <code>str_sub()</code> function from the [stringr]{.monospace} package allows us to extract text based on the location of the letters.
For example, let&#8217;s consider the small string of text [&#8220;<span class="caps">CDS102</span>&#8221;]{.monospace}.</p>
<div class="highlight"><pre><span></span><span class="n">cds102</span> <span class="o">&lt;-</span> <span class="s">&quot;CDS102&quot;</span>
</pre></div>


<p>The course code <span class="caps">CDS</span> starts on the first letter and ends on the third letter.
To get this part of the text using <code>str_sub()</code>, I would&nbsp;run:</p>
<div class="highlight"><pre><span></span><span class="n">cds102</span> <span class="o">%&gt;%</span>
  <span class="nf">str_sub</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</pre></div>


<p>[## [1] &#8220;<span class="caps">CDS</span>&#8221;]{.monospace}</p>
<p>The course number starts on the fourth letter and then goes to the end.
Note that, if the part of the string you are grabbing goes to the end, you don&#8217;t need to specify the [end =]{.monospace} keyword.
So, to get the [&#8220;102&#8221;]{.monospace} part of the text using <code>str_sub()</code>, I would&nbsp;run:</p>
<div class="highlight"><pre><span></span><span class="n">cds102</span> <span class="o">%&gt;%</span>
  <span class="nf">str_sub</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</pre></div>


<p>[## [1]&nbsp;&#8220;102&#8221;]{.monospace}</p>
<p>@get-city-state-codes.
    Apply <code>str_sub()</code> to [data_file_name]{.monospace} in order to extract the first two letters [<span class="caps">AL</span>]{.monospace}, and assign this to the variable [file_state]{.monospace}.
    Then, apply <code>str_sub()</code> again in order to extract the remaining letters [<span class="caps">HUNTSV</span>]{.monospace} and assign this to the variable&nbsp;[file_city]{.monospace}.</p>
<h2>Read a data file, label the&nbsp;dataset</h2>
<p>The data in [<span class="caps">ALHUNTSV</span>.txt]{.monospace} is not structured in the conventional csv format.
If we look at the first few lines of the&nbsp;file,</p>
<div class="highlight"><pre><span></span><span class="n">data_file</span> <span class="o">%&gt;%</span>
  <span class="nf">read_lines</span><span class="p">(</span><span class="n">n_max</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">str_flatten</span><span class="p">(</span><span class="n">collapse</span> <span class="o">=</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err"> 1             1             1995         48.8</span>
<span class="err"> 1             2             1995         32.1</span>
<span class="err"> 1             3             1995         31.2</span>
<span class="err"> 1             4             1995         32.5</span>
<span class="err"> 1             5             1995         21.1</span>
</pre></div>


<p>we see that there are four columns of data separated by spaces.
Because the separation of the spaces is predictable, we will want to use the <code>read_table()</code> function to read this file.
Since this data file does not specify the column names at the top of the file, we will need to input those&nbsp;manually.</p>
<p>@data-file-read-table.
    Review the <a href="#about-the-dataset"><i class="fas fa-link"></i>about the dataset</a> section and list the column names for [<span class="caps">ALHUNTSV</span>.txt]{.monospace} as inputs to the <code>combine()</code> function.
    As a reminder, the template for using <code>combine()</code> is,</p>
<div class="highlight"><pre><span></span><span class="err">```</span><span class="n">r</span><span class="w"></span>
<span class="n">combine</span><span class="p">(</span><span class="ss">&quot;column name 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;column name 2&quot;</span><span class="p">)</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>

<span class="n">Assign</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="o">[</span><span class="n">col\_names</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="p">.</span><span class="w"></span>
<span class="k">Then</span><span class="p">,</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="o">[</span><span class="n">col\_names</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="k">write</span><span class="err">:</span><span class="w"></span>

<span class="err">```</span><span class="n">r</span><span class="w"></span>
<span class="n">alhuntsv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data_file</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"></span>
<span class="w">  </span><span class="n">read_table</span><span class="p">(</span><span class="n">col_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_names</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"></span>
<span class="w">  </span><span class="n">mutate</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...,</span><span class="w"></span>
<span class="w">    </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"></span>
<span class="w">  </span><span class="n">mutate</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="nc">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_date</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="nf">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...,</span><span class="w"></span>
<span class="w">      </span><span class="nf">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...,</span><span class="w"></span>
<span class="w">      </span><span class="nf">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>

<span class="o">**</span><span class="n">You</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nf">replace</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">elipses</span><span class="w"> </span><span class="o">[</span><span class="n">...</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">work</span><span class="p">.</span><span class="o">**</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="err">`</span><span class="n">mutate</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">measured</span><span class="p">.</span><span class="w"></span>
<span class="n">Fill</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">inputs</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">variable</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="n">earlier</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lab</span><span class="p">.</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="err">`</span><span class="n">mutate</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">[</span><span class="n">date</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">make_date</span><span class="p">()</span><span class="err">`</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">[</span><span class="n">lubridate</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="w"> </span><span class="n">package</span><span class="p">.</span><span class="w"></span>
<span class="n">Fill</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">names</span><span class="w"> </span><span class="p">(</span><span class="n">these</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">listed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">[</span><span class="n">col\_names</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="p">)</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">correspond</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nf">year</span><span class="p">,</span><span class="w"> </span><span class="nf">month</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">day</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="n">measurements</span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>One data file down, only 324 more to&nbsp;go!</p>
<h2>User-defined&nbsp;functions</h2>
<p>Before we can continue, we need to take a detour and learn about the concept of <strong>user-defined functions</strong>, which are the fundamental building blocks for automation.
We&#8217;ve made use of many different functions during this course that were either pre-loaded by R or were loaded after running <code>library(tidyverse)</code>.
Any command that you run that has parentheses where you specify inputs, such as <code>ggplot()</code>, <code>filter()</code>, <code>mutate()</code>, <code>mean()</code>, etc. are functions.
We&#8217;ve managed to accomplish a lot simply by relying on these pre-loaded functions!
Now it&#8217;s time for you to create your&nbsp;own.</p>
<p>Functions that you create are known as <strong>user-defined functions</strong>, and an example of a simple user-defined function is as&nbsp;follows:</p>
<div class="highlight"><pre><span></span><span class="n">add</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="n">number2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">result</span> <span class="o">&lt;-</span> <span class="n">number1</span> <span class="o">+</span> <span class="n">number2</span>
  <span class="nf">cat</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="s">&quot;plus&quot;</span><span class="p">,</span> <span class="n">number2</span><span class="p">,</span> <span class="s">&quot;equals&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>This creates a user-defined function called <code>add()</code> that requires two inputs, [number1]{.monospace} and [number2]{.monospace}.
It then adds those numbers and prints a sentence that summarizes the computation.
Try it&nbsp;out!</p>
<p>@.<br>
    Copy and paste the code that defines the <code>add()</code> function into a code block and run the block.
    Create a second code block and run <code>add(4, 6)</code> and verify that you get some output.
    Then, right below <code>add(4, 6)</code>, type <code>add()</code> again and fill in your own two inputs and execute&nbsp;it.</p>
<p>Although this isn&#8217;t the most useful function that you can create, it does illustrate the basic procedure for creating a user-defined function in R.
Let&#8217;s review what we just&nbsp;did:</p>
<ul>
<li>
<p>We named our function <code>add()</code> in the same way that we&#8217;ve saved outputs to variables in previous labs, by using the [&lt;-]{.monospace}&nbsp;symbol</p>
</li>
<li>
<p>We indicate that we are creating a user-defined function by using the word&nbsp;[function]{.monospace}</p>
</li>
<li>
<p>The function inputs (these are also called <strong>arguments</strong>) are provided in the parentheses immediately following the word [function]{.monospace}, i.e. [number1]{.monospace} and [number2]{.monospace} in <code>function(number1, number2)</code></p>
</li>
<li>
<p>The code that the user-defined function will run is put between two curly braces, [{]{.monospace} and&nbsp;[}]{.monospace}.</p>
</li>
<li>
<p>The region between [{]{.monospace} and [}]{.monospace} is known as the <strong>function body</strong>, and you write code within the function body in the same way that you write code in an R Markdown code&nbsp;block</p>
</li>
<li>
<p>The inputs, in this case [number1]{.monospace} and [number2]{.monospace}, should be used somewhere in the function&nbsp;body</p>
</li>
<li>
<p>When you run <code>add(4, 6)</code>, the function automatically knows to substitute [4]{.monospace} wherever [number1]{.monospace} is and [6]{.monospace} wherever [number2]{.monospace} is, so the&nbsp;line,</p>
<p><code>r
result &lt;- number1 + number2</code></p>
<p>becomes</p>
<p><code>r
result &lt;- 4 + 6</code></p>
</li>
</ul>
<p>What if we wanted to access the result of <code>add(4, 6)</code>, which is [10]{.monospace}?
Maybe after we run <code>add(4, 6)</code> the variable [result]{.monospace} becomes defined.
In your <em>Console</em> window, type <code>add(4, 6)</code>, then type <code>result</code>.
I suspect that you&#8217;ll see the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="err">&gt; add(4, 6)</span>
<span class="err">4 plus 6 equals 10 </span>
<span class="err">&gt; result</span>
<span class="c">Error: object &#39;result&#39; not found</span>
</pre></div>


<p>So it seems like the variable [result]{.monospace} is &#8220;forgotten&#8221; after <code>add()</code> is run.
Instead, maybe we could try to save the result variable using [&lt;-]{.monospace} symbol.
In your <em>Console</em> window,&nbsp;type,</p>
<div class="highlight"><pre><span></span><span class="n">add_result</span> <span class="o">&lt;-</span> <span class="nf">add</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>
</pre></div>


<p>then type [add_result]{.monospace}.
When you do this, I suspect you&#8217;ll get a [<span class="caps">NULL</span>]{.monospace} instead of a&nbsp;[10]{.monospace}.</p>
<p>As you now see, the <code>add()</code> function, as written, is not allowing us to access the value of [10]{.monospace} when we try to save it.
How do we fix this?
It turns out that the fix is straightforward, we just need to put the word [result]{.monospace} on the last line of the function&nbsp;body:</p>
<div class="highlight"><pre><span></span><span class="n">add_fix</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="n">number2</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">result</span> <span class="o">&lt;-</span> <span class="n">number1</span> <span class="o">+</span> <span class="n">number2</span>
  <span class="nf">cat</span><span class="p">(</span><span class="n">number1</span><span class="p">,</span> <span class="s">&quot;plus&quot;</span><span class="p">,</span> <span class="n">number2</span><span class="p">,</span> <span class="s">&quot;equals&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
  <span class="n">result</span>
<span class="p">}</span>
</pre></div>


<p>Let&#8217;s try it&nbsp;out.</p>
<p>@.<br>
    Copy and paste the code that defines the function <code>add_fix()</code> into your R Markdown file.
    Then, create a second code block and&nbsp;run</p>
<div class="highlight"><pre><span></span><span class="n">```r</span>
<span class="n">add_result &lt;- add_fix(4, 6)</span>
<span class="n">```</span>

<span class="n">Check</span> <span class="n">the</span> <span class="n">value</span> <span class="n">inside</span> <span class="n">of</span> <span class="n">[add\_result]</span><span class="p">{</span><span class="n">.monospace</span><span class="p">}</span> <span class="n">to</span> <span class="n">confirm</span> <span class="n">that</span> <span class="n">it</span> <span class="n">is</span> <span class="n">equal</span> <span class="n">to</span> <span class="n">[10]</span><span class="p">{</span><span class="n">.monospace</span><span class="p">}</span><span class="n">.</span>
</pre></div>


<p>This demonstrates how we are able to <strong>return</strong> values from user-defined functions that we can save for later use.
The last thing we execute within the function body is what the function returns, and whatever is returned is what we can save for later use with the [&lt;-]{.monospace} symbol.
All other variables used in the function body are&nbsp;forgotten.</p>
<p>If you still don&#8217;t feel like you could make a user-defined function on your own without guidance, that&#8217;s okay!
It takes time and practice to get used to them.
Since this is still a new concept, you&#8217;ll continue to be given hints and provided with templates to help you&nbsp;out.</p>
<p>Let&#8217;s consider another example based on the [mpg]{.monospace} dataset.
If you were given this dataset for a lab, you might be asked to create a density plot for the [hwy]{.monospace}, [cty]{.monospace}, and [displ]{.monospace} variables.
Up until now, you would create three different code blocks to complete this task that might look like&nbsp;this:</p>
<pre><code>&#96;&#96;&#96;{r}
ggplot(data = mpg) +
  geom_density(
    mapping = aes(x = hwy)
  )
&#96;&#96;&#96;

&#96;&#96;&#96;{r}
ggplot(data = mpg) +
  geom_density(
    mapping = aes(x = cty)
  )
&#96;&#96;&#96;

&#96;&#96;&#96;{r}
ggplot(data = mpg) +
  geom_density(
    mapping = aes(x = displ)
  )
&#96;&#96;&#96;</code></pre>

<p>These three blocks of code are nearly identical, with the only difference between them being the input for the <code>aes()</code> function.
This seems like a good candidate for a user-defined function!
If I asked you to build one yourself based on what we&#8217;ve seen so far, you might try&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="c1"># SPOILER ALERT: This function won&#39;t work</span>
<span class="n">mpg_density_plot</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_density</span><span class="p">(</span>
      <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">variable</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>If you defined this function and then ran <code>mpg_density_plot(hwy)</code>, instead of getting a visualization, you&#8217;ll get the disappointing&nbsp;message:</p>
<div class="highlight"><pre><span></span><span class="n">Error</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">FUN</span><span class="p">(</span><span class="n">X</span><span class="o">[</span><span class="n">[i</span><span class="o">]</span><span class="err">]</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="s1">&#39;hwy&#39;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">found</span><span class="w"></span>
</pre></div>


<p>Like so many other cases, [tidyverse]{.monospace} functions have their own way of doing things compared to regular R, and this includes how you can specify <strong>unquoted variables</strong> in a user-defined function.
Without special handling, what R will do here is check to see if [hwy]{.monospace} is a variable that stores a value.
If it doesn&#8217;t, then it just prints an error message and stops.
If you want to be able to run <code>mpg_density_plot(hwy)</code> without getting an error message, you need to modify the function definition to the&nbsp;following: </p>
<div class="highlight"><pre><span></span><span class="c1"># Unlike before, this function will now work</span>
<span class="n">mpg_density_plot</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">user_input</span> <span class="o">&lt;-</span> <span class="n">rlang</span><span class="o">::</span><span class="nf">enquo</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_density</span><span class="p">(</span>
      <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="o">!!</span><span class="n">user_input</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>Let&#8217;s try this&nbsp;out.</p>
<p>@.<br>
    Copy and paste the code that defines the corrected [mpg_density_plot]{.monospace} function into a code block and run the block.
    Then, create three more code blocks and use [mpg_density_plot]{.monospace} to create density plots for the [hwy]{.monospace}, [cty]{.monospace}, and [displ]{.monospace}&nbsp;variables.</p>
<p>The line <code>user_input &lt;- rlang::enquo(variable)</code> converts the word you give as input to [mpg_density_plot]{.monospace} into a special format that is used in the [tidyverse]{.monospace} packages.
When that word later needs to be used to specify a column name in a dataset, you put two exclamation points in front of it, i.e. <code>aes(x = !!user_input)</code>.
This would also be what you would have to do if you wanted to use a command from [dplyr]{.monospace}, such as <code>select()</code>,</p>
<div class="highlight"><pre><span></span><span class="n">mpg_select</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">user_input</span> <span class="o">&lt;-</span> <span class="n">rlang</span><span class="o">::</span><span class="nf">enquo</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
  <span class="n">mpg</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="o">!!</span><span class="n">user_input</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>


<p>This allows us to select a single column like&nbsp;so:</p>
<div class="highlight"><pre><span></span><span class="nf">mpg_select</span><span class="p">(</span><span class="n">hwy</span><span class="p">)</span>
</pre></div>


<table>
 <thead>
  <tr>
   <th style="text-align:left;"> hwy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 29 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 29 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 30 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 26 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 26 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &#8230; </td>
  </tr>
</tbody>
</table>

<p>Again, don&#8217;t worry right now if this business with <code>rlang::enquo()</code> and [!!]{.monospace} doesn&#8217;t make total sense to you.
This example was meant to show you what is required if you want to specify column names in the inputs to your user-defined function.
That way you have a reference to come back to in case you ever need to do&nbsp;this!</p>
<h2>Function to read a data&nbsp;file</h2>
<p>Now that we&#8217;ve learned a bit about what functions are, let&#8217;s take what we did in the <a href="#extracting-information-from-a-file-name"><i class="fas fa-link"></i>extracting information from a file name</a> and <a href="#read-a-data-file-label-the-dataset"><i class="fas fa-link"></i>read a data file, label the dataset</a> sections and combine this code into a single&nbsp;function.</p>
<p>@.<br>
    The structure for our user-defined function <code>read_data_file()</code> is as&nbsp;follows:</p>
<div class="highlight"><pre><span></span><span class="err">```</span><span class="n">r</span><span class="w"></span>
<span class="n">read_data_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">file_state</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">two</span><span class="o">-</span><span class="n">letter</span><span class="w"> </span><span class="k">state</span><span class="o">/</span><span class="n">country</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">file_city</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="k">names</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">filename</span><span class="w"></span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">col_names</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">names</span><span class="w"></span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">temperature_data_frame</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">data</span><span class="w"></span>

<span class="w">  </span><span class="n">temperature_data_frame</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="err">```</span><span class="w"></span>

<span class="k">Using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Exercises</span><span class="w"> </span><span class="nv">@path</span><span class="o">-</span><span class="k">file</span><span class="o">-</span><span class="n">cleanup</span><span class="p">,</span><span class="w"> </span><span class="nv">@get</span><span class="o">-</span><span class="n">city</span><span class="o">-</span><span class="k">state</span><span class="o">-</span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">@data</span><span class="o">-</span><span class="k">file</span><span class="o">-</span><span class="k">read</span><span class="o">-</span><span class="nc">table</span><span class="p">,</span><span class="w"> </span><span class="nf">replace</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">four</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">comments</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">code</span><span class="p">.</span><span class="w"></span>
<span class="o">**</span><span class="k">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">implemented</span><span class="w"> </span><span class="n">correctly</span><span class="p">,</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="err">`</span><span class="n">read_data_file</span><span class="p">(</span><span class="k">path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;ALHUNTSV&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;txt&quot;</span><span class="p">))</span><span class="err">`</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">produce</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="o">[</span><span class="n">alhuntsv</span><span class="o">]</span><span class="err">{</span><span class="p">.</span><span class="n">monospace</span><span class="err">}</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">_Console_</span><span class="w"> </span><span class="n">pane</span><span class="p">.</span><span class="o">**</span><span class="w"></span>
</pre></div>


<h2>Read all the data&nbsp;files</h2>
<p>Now that we have <code>read_data_file()</code> defined, we&#8217;re ready to read and combine the rest of the data files together into one large data frame.
To do this, we will need a list of all the data files in the [data/]{.monospace} folder.
The [fs]{.monospace} package, like usual, provides us with a convenient function, the <code>dir_ls()</code> function, that lists of all the files in a given folder.
To list our files, we simply need to&nbsp;run,</p>
<div class="highlight"><pre><span></span><span class="n">data_files</span> <span class="o">&lt;-</span> <span class="n">data_dir</span> <span class="o">%&gt;%</span>
  <span class="nf">dir_ls</span><span class="p">(</span><span class="n">glob</span> <span class="o">=</span> <span class="s">&quot;*.txt&quot;</span><span class="p">)</span>
</pre></div>


<p>The [glob = &#8220;*.txt&#8221;]{.monospace} input tells <code>dir_ls()</code> to only list files ending with <code>.txt</code>, which are our temperature data&nbsp;files.</p>
<p>Now we need a way to apply <code>read_data_file()</code> to every file listed in [data_files]{.monospace}, which will produce a series of data frames containing the temperature data for every location.
We then need to take those data frames and bind all the rows together to create a single data frame we can use.
Lucky for us, [tidyverse]{.monospace} loads a very convenient function that can do exactly this, the <code>map_dfr()</code> function,</p>
<div class="highlight"><pre><span></span><span class="n">temperature_df</span> <span class="o">&lt;-</span> <span class="n">data_files</span> <span class="o">%&gt;%</span>
  <span class="nf">map_dfr</span><span class="p">(</span><span class="n">read_data_file</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="nf">if_else</span><span class="p">(</span>
      <span class="nf">near</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="m">-99</span><span class="p">),</span>
      <span class="nf">as.numeric</span><span class="p">(</span><span class="kc">NA</span><span class="p">),</span>
      <span class="n">temperature</span>
    <span class="p">)</span>
  <span class="p">)</span>
</pre></div>


<p>@.<br>
    Copy and run the code for creating [data_files]{.monospace} and then [temperature_df]{.monospace}.
    Verify that [temperature_df]{.monospace} has more than 2.7 million&nbsp;rows.</p>
<div class="highlight"><pre><span></span>The `mutate()` function is creating a new column called temperature and is using the `if_else()` function to replace any temperature values equal to [-99]{.monospace} with `NA`.
Explain why we want to do this.

::: {.callout .primary}
[Hint]{.h4}

If you are having trouble remembering what a value of [-99]{.monospace} means, go back and read the [<span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">&quot;fas fa-link&quot;</span><span class="nt">&gt;&lt;/i&gt;</span>about the dataset](#about-the-dataset) section.
:::
</pre></div>


<h2>Explore your new temperature&nbsp;database</h2>
<p>Now that we have all our data in one place, we should take a look at what&#8217;s in it.
First, let&#8217;s remove the [<span class="caps">NA</span>]{.monospace} values in the [temperature]{.monospace} column, as those rows represent missing measurements and so we don&#8217;t need to keep them for our analysis.
We should also remove the year 2018 from the dataset, as the data collection for the year is still in&nbsp;progress.</p>
<p>@.<br>
    Use <code>filter()</code> and <code>is.na()</code> to remove the [<span class="caps">NA</span>]{.monospace} values from the [temperature]{.monospace} column.
    Then use filter to remove data for the year 2019.
    Assign the result to&nbsp;[temperature_df_filtered]{.monospace}.</p>
<p>Let&#8217;s start with a query for the temperature data for Washington, <span class="caps">DC</span>.</p>
<p>@.
    Filter [temperature_df_filtered]{.monospace} to only contain the temperature data for Washington, <span class="caps">DC</span>.
    To figure out the filename for Washington, <span class="caps">DC</span>, check here: <a href="http://academic.udayton.edu/kissock/http/Weather/citylistUS.htm">http://academic.udayton.edu/kissock/http/Weather/citylistUS.htm</a>.
    Assign the filtered dataset to&nbsp;[washdc]{.monospace}.</p>
<p>Let&#8217;s create a visualization showing the average daily temperatures as a function of time for Washington, <span class="caps">DC</span>.</p>
<p>@.<br>
    Make a scatter plot of your [washdc]{.monospace} dataset using [date]{.monospace} for the horizontal axis and [temperature]{.monospace} for the vertical axis.
    After you&#8217;ve created the plot, explain why you see the daily average temperatures consistently oscillating between higher and lower temperatures as a function of&nbsp;time.</p>
<p>Let&#8217;s see if the average and median temperatures per year in Washington, <span class="caps">DC</span> have stayed&nbsp;consistent.</p>
<p>@.<br>
    Take [washdc]{.monospace} and group by the [year]{.monospace} column.
    Then, within this group, calculate both the mean (average) temperature and the median (middle) temperature.
    Assign this result to a variable called [washdc_year]{.monospace}.
    Then, create two separate scatter plots, one plotting [year]{.monospace} along the horizontal axis and the mean temperature per year along the vertical axis and the other plotting [year]{.monospace} along the horizontal axis and the median temperature per year for the vertical axis.
    Also include <code>geom_smooth()</code> on each of these plots.
    Describe the trends you&nbsp;see.</p>
<p>Finally, let&#8217;s take a more global view of the data and look at the average and median temperatures per year across the entire&nbsp;dataset.</p>
<p>@.<br>
    Take [temperature_df_filtered]{.monospace} and group by the [year]{.monospace} column.
    Then, within this group, calculate both the mean (average) temperature and the median (middle) temperature.
    Assign this result to a variable called [world_year]{.monospace}.
    Then, create two separate scatter plots, one plotting [year]{.monospace} along the horizontal axis and the mean temperature per year along the vertical axis and the other plotting [year]{.monospace} along the horizontal axis and the median temperature per year for the vertical axis.
    Also include <code>geom_smooth()</code> on each of these plots.
    Describe the trends you&nbsp;see.</p>
<p>There&#8217;s plenty more you could do with this dataset, but that&#8217;s enough for&nbsp;now.</p>
<h2>How to&nbsp;submit</h2>
<p>To submit your lab, follow the two steps below.
Your lab will be graded for credit <strong>after</strong> you&#8217;ve completed both&nbsp;steps!</p>
<ol>
<li>
<p>Save, commit, and push your completed R Markdown file so that everything is synchronized to GitHub.
    If you do this right, then you will be able to view your completed file on the GitHub&nbsp;website.</p>
</li>
<li>
<p>Knit your R Markdown document to the <span class="caps">PDF</span> format, export (download) the <span class="caps">PDF</span> file from RStudio Server, and then upload it to <em>Lab 10</em> posting on&nbsp;Blackboard.</p>
</li>
</ol>
<h2>Cheatsheets</h2>
<p>You are encouraged to review and keep the following cheatsheets handy while working on this&nbsp;lab:</p>
<ul>
<li>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">data import/tidyr&nbsp;cheatsheet</a></p>
</li>
<li>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">dplyr&nbsp;cheatsheet</a></p>
</li>
<li>
<p><a href="https://www.rstudio.com/wp-content/uploads/2016/11/ggplot2-cheatsheet-2.1.pdf">ggplot2&nbsp;cheatsheet</a></p>
</li>
<li>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/rstudio-ide.pdf">RStudio&nbsp;cheatsheet</a></p>
</li>
<li>
<p><a href="https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf">R Markdown&nbsp;cheatsheet</a></p>
</li>
<li>
<p><a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">R Markdown&nbsp;reference</a></p>
</li>
</ul>
<h2>Credits</h2>
<p>This lab is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
Exercises and instructions written by James Glasbrenner for <span class="caps">CDS</span>-102.</p>
</div>    </article>
    </div>
<footer class="page-footer">
    <div class="footer-grid-container">
      Except where otherwise noted, site materials are created by
      <a href="https://cos.gmu.edu/cds/faculty-profile-james-glasbrenner/">
        James K. Glasbrenner
      </a>
      and
      <a href="https://cos.gmu.edu/cds/faculty-profile-dominic-white/">
        Dominic White
      </a>
      and licensed under a
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        Creative Commons Attribution-ShareAlike 4.0 International License
      </a>.
    </div>
</footer><script src="/theme/js/cds101.min.js"></script>
  <script src="/theme/js/vendor/highlightjs/highlight.min.js"></script>
  <script src="/theme/js/vendor/katex/katex.min.js"></script>
  <script src="/theme/js/vendor/katex/contrib/auto-render.min.js"></script>
  <script src="/theme/js/vendor/wookmark/wookmark.min.js"></script>
  <script src="/theme/js/vendor/fontawesome/fontawesome-all.min.js"></script>
  <script src="/theme/js/vendor/vendorInit.js"></script>
  </body>
</html>